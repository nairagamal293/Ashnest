<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ashnest - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --sidebar-width: 250px;
            --header-height: 70px;
        }
        
        body {
            background-color: #f5f7fb;
            overflow-x: hidden;
        }
        
        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            background: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
            z-index: 1000;
            transition: all 0.3s;
        }
        
        #sidebar .sidebar-header {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        #sidebar ul.components {
            padding: 1rem 0;
        }
        
        #sidebar ul li a {
            padding: 0.8rem 1.5rem;
            display: block;
            color: #4a5568;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        
        #sidebar ul li a:hover {
            background-color: #f7fafc;
            color: var(--primary);
        }
        
        #sidebar ul li a.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }
        
        #sidebar ul li a i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }
        
        #content {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            min-height: 100vh;
        }
        
        .navbar {
            height: var(--header-height);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            background: white;
        }
        
        .main-content {
            padding: 1.5rem;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card {
            padding: 1.5rem;
        }
        
        .stat-card .icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-card .value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .stat-card .label {
            color: #718096;
            font-size: 0.875rem;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .data-table {
            border-radius: 12px;
            overflow: hidden;
        }
        
        .data-table table th {
            background-color: #f7fafc;
            border-top: none;
            font-weight: 600;
            color: #4a5568;
            padding: 1rem;
        }
        
        .data-table table td {
            padding: 1rem;
            vertical-align: middle;
        }
        
        .status-badge {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .user-dropdown .dropdown-toggle::after {
            display: none;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: var(--warning);
            color: white;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            border-radius: 12px;
            border: none;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 0.75rem 1rem;
        }
        
        .btn {
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
        }
        
        .pagination .page-link {
            border-radius: 8px;
            margin: 0 3px;
        }
        
        .tab-content {
            padding: 1.5rem 0;
        }
        
        .nav-tabs .nav-link {
            border: none;
            padding: 0.75rem 1.5rem;
            color: #4a5568;
            border-radius: 8px;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary);
            color: white;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            #sidebar {
                margin-left: -var(--sidebar-width);
            }
            
            #sidebar.active {
                margin-left: 0;
            }
            
            #content {
                width: 100%;
                margin-left: 0;
            }
            
            #content.active {
                margin-left: var(--sidebar-width);
                width: calc(100% - var(--sidebar-width));
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <h3>Ashnest</h3>
        </div>
        
        <ul class="list-unstyled components">
            <li>
                <a href="#" class="active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            <li>
                <a href="#" data-section="orders">
                    <i class="fas fa-shopping-cart"></i> Orders
                </a>
            </li>
            <li>
                <a href="#" data-section="products">
                    <i class="fas fa-box"></i> Products
                </a>
            </li>
            <li>
                <a href="#" data-section="categories">
                    <i class="fas fa-layer-group"></i> Categories
                </a>
            </li>
            <li>
                <a href="#" data-section="users">
                    <i class="fas fa-users"></i> Customers
                </a>
            </li>
            <li>
                <a href="#" data-section="coupons">
                    <i class="fas fa-tags"></i> Coupons
                </a>
            </li>
            <li>
                <a href="#" data-section="reviews">
                    <i class="fas fa-star"></i> Reviews
                </a>
            </li>
        </ul>
        
        <div class="px-3 mt-auto mb-4">
            <div class="d-grid">
                <button class="btn btn-outline-danger" id="logoutBtn">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Content -->
    <div id="content">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <button type="button" id="sidebarCollapse" class="btn btn-light">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="d-flex align-items-center">
                    <div class="position-relative me-3">
                        <button class="btn btn-light position-relative">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>
                    
                    <div class="dropdown user-dropdown">
                        <button class="btn dropdown-toggle d-flex align-items-center" type="button" id="userDropdown" data-bs-toggle="dropdown">
                            <img src="https://ui-avatars.com/api/?name=Admin+User&background=4361ee&color=fff" alt="User" class="avatar me-2">
                            <span id="userName">Admin User</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="dropdownLogout"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section active">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Dashboard Overview</h4>
                    <div>
                        <button class="btn btn-outline-secondary me-2" id="refreshDashboard">
                            <i class="fas fa-sync-alt me-1"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="card stat-card">
                            <div class="icon bg-primary bg-opacity-10 text-primary">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="value text-primary" id="totalOrders">0</div>
                            <div class="label">Total Orders</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="card stat-card">
                            <div class="icon bg-success bg-opacity-10 text-success">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="value text-success" id="totalRevenue">$0</div>
                            <div class="label">Total Revenue</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="card stat-card">
                            <div class="icon bg-info bg-opacity-10 text-info">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="value text-info" id="totalCustomers">0</div>
                            <div class="label">Customers</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="card stat-card">
                            <div class="icon bg-warning bg-opacity-10 text-warning">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="value text-warning" id="lowStockItems">0</div>
                            <div class="label">Low Stock Items</div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="row mb-4">
                    <div class="col-lg-8 mb-3">
                        <div class="card">
                            <div class="card-header bg-white border-0">
                                <h5 class="mb-0">Sales Overview</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="salesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mb-3">
                        <div class="card">
                            <div class="card-header bg-white border-0">
                                <h5 class="mb-0">Top Categories</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="categoriesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="card">
                    <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Recent Orders</h5>
                        <a href="#" class="btn btn-sm btn-outline-primary view-all-btn" data-section="orders">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive data-table">
                            <table class="table table-hover" id="recentOrdersTable">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Orders will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="orders-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Order Management</h4>
                    <div>
                        <button class="btn btn-outline-secondary me-2" id="exportOrders">
                            <i class="fas fa-download me-1"></i> Export
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-white border-0">
                        <ul class="nav nav-tabs card-header-tabs" id="ordersTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="all-orders-tab" data-bs-toggle="tab" data-bs-target="#all-orders" type="button" role="tab">All Orders</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="pending-orders-tab" data-bs-toggle="tab" data-bs-target="#pending-orders" type="button" role="tab">Pending</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="processing-orders-tab" data-bs-toggle="tab" data-bs-target="#processing-orders" type="button" role="tab">Processing</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="shipped-orders-tab" data-bs-toggle="tab" data-bs-target="#shipped-orders" type="button" role="tab">Shipped</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="delivered-orders-tab" data-bs-toggle="tab" data-bs-target="#delivered-orders" type="button" role="tab">Delivered</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="ordersTabContent">
                            <div class="tab-pane fade show active" id="all-orders" role="tabpanel">
                                <div class="table-responsive data-table">
                                    <table class="table table-hover" id="ordersTable">
                                        <thead>
                                            <tr>
                                                <th>Order #</th>
                                                <th>Customer</th>
                                                <th>Date</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Orders will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Orders pagination">
                                    <ul class="pagination justify-content-center" id="ordersPagination">
                                        <!-- Pagination will be populated here -->
                                    </ul>
                                </nav>
                            </div>
                            <!-- Other tab panes will be populated similarly -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="products-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Product Management</h4>
                    <div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                            <i class="fas fa-plus me-1"></i> Add Product
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">All Products</h5>
                        <div class="d-flex">
                            <input type="text" class="form-control me-2" placeholder="Search products..." id="productSearch">
                            <select class="form-select" id="productCategoryFilter">
                                <option value="">All Categories</option>
                                <!-- Categories will be populated here -->
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive data-table">
                            <table class="table table-hover" id="productsTable">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Products will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Products pagination">
                            <ul class="pagination justify-content-center" id="productsPagination">
                                <!-- Pagination will be populated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categories-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Category Management</h4>
                    <div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                            <i class="fas fa-plus me-1"></i> Add Category
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header bg-white border-0">
                                <h5 class="mb-0">All Categories</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive data-table">
                                    <table class="table table-hover" id="categoriesTable">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Description</th>
                                                <th>Products</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Categories will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-white border-0">
                                <h5 class="mb-0">Category Structure</h5>
                            </div>
                            <div class="card-body">
                                <div id="categoryTree">
                                    <!-- Category tree will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Customer Management</h4>
                    <div>
                        <button class="btn btn-outline-secondary me-2" id="exportCustomers">
                            <i class="fas fa-download me-1"></i> Export
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-0">All Customers</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive data-table">
                            <table class="table table-hover" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Orders</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Users will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Users pagination">
                            <ul class="pagination justify-content-center" id="usersPagination">
                                <!-- Pagination will be populated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Coupons Section -->
            <div id="coupons-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Coupon Management</h4>
                    <div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCouponModal">
                            <i class="fas fa-plus me-1"></i> Add Coupon
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-white border-0">
                        <ul class="nav nav-tabs card-header-tabs" id="couponsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="all-coupons-tab" data-bs-toggle="tab" data-bs-target="#all-coupons" type="button" role="tab">All Coupons</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="active-coupons-tab" data-bs-toggle="tab" data-bs-target="#active-coupons" type="button" role="tab">Active</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="expired-coupons-tab" data-bs-toggle="tab" data-bs-target="#expired-coupons" type="button" role="tab">Expired</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="couponsTabContent">
                            <div class="tab-pane fade show active" id="all-coupons" role="tabpanel">
                                <div class="table-responsive data-table">
                                    <table class="table table-hover" id="couponsTable">
                                        <thead>
                                            <tr>
                                                <th>Code</th>
                                                <th>Discount</th>
                                                <th>Usage</th>
                                                <th>Expires</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Coupons will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Coupons pagination">
                                    <ul class="pagination justify-content-center" id="couponsPagination">
                                        <!-- Pagination will be populated here -->
                                    </ul>
                                </nav>
                            </div>
                            <!-- Other tab panes will be populated similarly -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reviews Section -->
            <div id="reviews-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Review Management</h4>
                    <div>
                        <select class="form-select me-2" id="reviewFilter" style="width: auto;">
                            <option value="all">All Reviews</option>
                            <option value="pending">Pending Approval</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-0">Product Reviews</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive data-table">
                            <table class="table table-hover" id="reviewsTable">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Customer</th>
                                        <th>Rating</th>
                                        <th>Review</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Reviews will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Reviews pagination">
                            <ul class="pagination justify-content-center" id="reviewsPagination">
                                <!-- Pagination will be populated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Modals for various operations -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="productName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="productCategory" class="form-label">Category</label>
                                <select class="form-select" id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <!-- Categories will be populated here -->
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="productPrice" class="form-label">Price</label>
                                <input type="number" step="0.01" class="form-control" id="productPrice" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="productStock" class="form-label">Stock Quantity</label>
                                <input type="number" class="form-control" id="productStock" required>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="productDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="productDescription" rows="3"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="productImages" class="form-label">Product Images</label>
                                <input type="file" class="form-control" id="productImages" multiple accept="image/*">
                                <div class="form-text">Upload product images (max 5 images)</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveProduct">Save Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div class="modal fade" id="editProductModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProductForm">
                        <input type="hidden" id="editProductId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editProductName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="editProductName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editProductCategory" class="form-label">Category</label>
                                <select class="form-select" id="editProductCategory" required>
                                    <option value="">Select Category</option>
                                    <!-- Categories will be populated here -->
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editProductPrice" class="form-label">Price</label>
                                <input type="number" step="0.01" class="form-control" id="editProductPrice" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editProductStock" class="form-label">Stock Quantity</label>
                                <input type="number" class="form-control" id="editProductStock" required>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="editProductDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="editProductDescription" rows="3"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="editProductStatus" class="form-label">Status</label>
                                <select class="form-select" id="editProductStatus">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Current Images</label>
                                <div id="currentProductImages" class="d-flex flex-wrap"></div>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="editProductImages" class="form-label">Add New Images</label>
                                <input type="file" class="form-control" id="editProductImages" multiple accept="image/*">
                                <div class="form-text">Upload new product images (max 5 images)</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateProduct">Update Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal fade" id="addCategoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCategoryForm">
                        <div class="mb-3">
                            <label for="categoryName" class="form-label">Category Name</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <div class="mb-3">
                            <label for="categoryDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="parentCategory" class="form-label">Parent Category</label>
                            <select class="form-select" id="parentCategory">
                                <option value="">None (Top Level Category)</option>
                                <!-- Categories will be populated here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="categoryImage" class="form-label">Category Image</label>
                            <input type="file" class="form-control" id="categoryImage" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveCategory">Save Category</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div class="modal fade" id="editCategoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editCategoryForm">
                        <input type="hidden" id="editCategoryId">
                        <div class="mb-3">
                            <label for="editCategoryName" class="form-label">Category Name</label>
                            <input type="text" class="form-control" id="editCategoryName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editCategoryDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editCategoryDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editParentCategory" class="form-label">Parent Category</label>
                            <select class="form-select" id="editParentCategory">
                                <option value="">None (Top Level Category)</option>
                                <!-- Categories will be populated here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Current Image</label>
                            <div id="currentCategoryImage" class="mb-2"></div>
                        </div>
                        <div class="mb-3">
                            <label for="editCategoryImage" class="form-label">Update Image</label>
                            <input type="file" class="form-control" id="editCategoryImage" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateCategory">Update Category</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Coupon Modal -->
    <div class="modal fade" id="addCouponModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Coupon</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCouponForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="couponCode" class="form-label">Coupon Code</label>
                                <input type="text" class="form-control" id="couponCode" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="discountPercentage" class="form-label">Discount Percentage</label>
                                <input type="number" step="0.01" min="1" max="100" class="form-control" id="discountPercentage" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="expiryDate" class="form-label">Expiry Date</label>
                                <input type="date" class="form-control" id="expiryDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="usageLimit" class="form-label">Usage Limit</label>
                                <input type="number" class="form-control" id="usageLimit" placeholder="Unlimited if empty">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="minOrderAmount" class="form-label">Minimum Order Amount</label>
                                <input type="number" step="0.01" class="form-control" id="minOrderAmount" placeholder="No minimum if empty">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveCoupon">Save Coupon</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Coupon Modal -->
    <div class="modal fade" id="editCouponModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Coupon</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editCouponForm">
                        <input type="hidden" id="editCouponId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editCouponCode" class="form-label">Coupon Code</label>
                                <input type="text" class="form-control" id="editCouponCode" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editDiscountPercentage" class="form-label">Discount Percentage</label>
                                <input type="number" step="0.01" min="1" max="100" class="form-control" id="editDiscountPercentage" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editExpiryDate" class="form-label">Expiry Date</label>
                                <input type="date" class="form-control" id="editExpiryDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editUsageLimit" class="form-label">Usage Limit</label>
                                <input type="number" class="form-control" id="editUsageLimit" placeholder="Unlimited if empty">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editMinOrderAmount" class="form-label">Minimum Order Amount</label>
                                <input type="number" step="0.01" class="form-control" id="editMinOrderAmount" placeholder="No minimum if empty">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editCouponStatus" class="form-label">Status</label>
                                <select class="form-select" id="editCouponStatus">
                                    <option value="true">Active</option>
                                    <option value="false">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateCoupon">Update Coupon</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Order Details - <span id="orderNumber"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6>Customer Information</h6>
                            <p id="customerInfo"></p>
                        </div>
                        <div class="col-md-6">
                            <h6>Shipping Address</h6>
                            <p id="shippingAddress"></p>
                        </div>
                    </div>
                    
                    <h6>Order Items</h6>
                    <div class="table-responsive">
                        <table class="table" id="orderItemsTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Order items will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Order Status</h6>
                            <div class="d-flex align-items-center">
                                <select class="form-select me-2" id="orderStatusSelect">
                                    <option value="Pending">Pending</option>
                                    <option value="Processing">Processing</option>
                                    <option value="Shipped">Shipped</option>
                                    <option value="Delivered">Delivered</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                                <button class="btn btn-primary" id="updateOrderStatus">Update</button>
                            </div>
                        </div>
                        <div class="col-md-6 text-end">
                            <p><strong>Subtotal: </strong><span id="orderSubtotal"></span></p>
                            <p><strong>Discount: </strong><span id="orderDiscount"></span></p>
                            <p><strong>Total: </strong><span id="orderTotal"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // API Base URL
        const API_BASE = 'https://localhost:7124/api';
        let currentUser = null;
        let authToken = localStorage.getItem('token');

        // Check authentication
        if (!authToken) {
            window.location.href = 'login.html';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // Initialize the application
        async function initializeApp() {
            try {
                // Get current user info
                await fetchCurrentUser();
                
                // Setup event listeners
                setupEventListeners();
                
                // Load dashboard data
                await loadDashboardData();
                
                // Load initial data for other sections
                await loadOrders();
                await loadProducts();
                await loadCategories();
                await loadUsers();
                await loadCoupons();
                await loadReviews();
                
            } catch (error) {
                console.error('Error initializing app:', error);
                alert('Failed to initialize application. Please check your connection and try again.');
            }
        }

        // Fetch current user information
        async function fetchCurrentUser() {
            try {
                const response = await fetch(`${API_BASE}/Users/profile`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    document.getElementById('userName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
                } else if (response.status === 401) {
                    // Token expired or invalid
                    logout();
                }
            } catch (error) {
                console.error('Error fetching user:', error);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar toggle
            document.getElementById('sidebarCollapse').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
                document.getElementById('content').classList.toggle('active');
            });
            
            // Navigation
            document.querySelectorAll('#sidebar a[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    
                    // Update active state
                    document.querySelectorAll('#sidebar a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show the selected section
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    document.getElementById(`${section}-section`).classList.add('active');
                });
            });
            
            // View all buttons
            document.querySelectorAll('.view-all-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    
                    // Update active state
                    document.querySelectorAll('#sidebar a').forEach(a => a.classList.remove('active'));
                    document.querySelector(`a[data-section="${section}"]`).classList.add('active');
                    
                    // Show the selected section
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    document.getElementById(`${section}-section`).classList.add('active');
                });
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('dropdownLogout').addEventListener('click', logout);
            
            // Refresh dashboard
            document.getElementById('refreshDashboard').addEventListener('click', loadDashboardData);
            
            // Save product
            document.getElementById('saveProduct').addEventListener('click', addProduct);
            
            // Update product
            document.getElementById('updateProduct').addEventListener('click', updateProduct);
            
            // Save category
            document.getElementById('saveCategory').addEventListener('click', addCategory);
            
            // Update category
            document.getElementById('updateCategory').addEventListener('click', updateCategory);
            
            // Save coupon
            document.getElementById('saveCoupon').addEventListener('click', addCoupon);
            
            // Update coupon
            document.getElementById('updateCoupon').addEventListener('click', updateCoupon);
            
            // Update order status
            document.getElementById('updateOrderStatus').addEventListener('click', updateOrderStatus);
            
            // Product search
            document.getElementById('productSearch').addEventListener('input', function() {
                const searchTerm = this.value;
                const categoryId = document.getElementById('productCategoryFilter').value;
                loadProducts(categoryId, searchTerm);
            });
            
            // Product category filter
            document.getElementById('productCategoryFilter').addEventListener('change', function() {
                const categoryId = this.value;
                const searchTerm = document.getElementById('productSearch').value;
                loadProducts(categoryId, searchTerm);
            });
            
            // Review filter
            document.getElementById('reviewFilter').addEventListener('change', function() {
                const filter = this.value;
                loadReviews(filter);
            });
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Fetch sales report for the current month
                const now = new Date();
                const startDate = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
                const endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().split('T')[0];
                
                const salesReportResponse = await fetch(`${API_BASE}/Admin/sales-report?startDate=${startDate}&endDate=${endDate}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (salesReportResponse.ok) {
                    const salesReport = await salesReportResponse.json();
                    updateDashboardStats(salesReport);
                }
                
                // Fetch inventory report
                const inventoryReportResponse = await fetch(`${API_BASE}/Admin/inventory-report`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (inventoryReportResponse.ok) {
                    const inventoryReport = await inventoryReportResponse.json();
                    document.getElementById('lowStockItems').textContent = inventoryReport.lowStockProducts;
                }
                
                // Fetch customer report
                const customerReportResponse = await fetch(`${API_BASE}/Admin/customer-report`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (customerReportResponse.ok) {
                    const customerReport = await customerReportResponse.json();
                    document.getElementById('totalCustomers').textContent = customerReport.totalCustomers;
                }
                
                // Fetch recent orders
                const ordersResponse = await fetch(`${API_BASE}/Orders/all`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (ordersResponse.ok) {
                    const orders = await ordersResponse.json();
                    updateRecentOrders(orders.slice(0, 5)); // Show only 5 most recent
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats(salesReport) {
            document.getElementById('totalOrders').textContent = salesReport.totalOrders;
            document.getElementById('totalRevenue').textContent = `$${salesReport.totalRevenue.toFixed(2)}`;
            
            // Update charts
            updateSalesChart(salesReport.dailySales);
            updateCategoriesChart(salesReport.categorySales);
        }

        // Update sales chart
        function updateSalesChart(dailySales) {
            const labels = dailySales.map(item => {
                const date = new Date(item.date);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            
            const data = dailySales.map(item => item.revenue);
            
            const salesChart = new Chart(document.getElementById('salesChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Daily Revenue',
                        data: data,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Update categories chart
        function updateCategoriesChart(categorySales) {
            const labels = categorySales.map(item => item.categoryName);
            const data = categorySales.map(item => item.revenue);
            
            const colors = [
                '#4361ee',
                '#4cc9f0',
                '#f72585',
                '#7209b7',
                '#3a0ca3',
                '#560bad',
                '#480ca8'
            ];
            
            const categoriesChart = new Chart(document.getElementById('categoriesChart'), {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    cutout: '70%'
                }
            });
        }

        // Update recent orders table
        function updateRecentOrders(orders) {
            const tbody = document.querySelector('#recentOrdersTable tbody');
            tbody.innerHTML = '';
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                
                // Format order date
                const orderDate = new Date(order.orderDate).toLocaleDateString();
                
                // Create status badge
                let statusClass = '';
                switch(order.status) {
                    case 'Delivered':
                        statusClass = 'bg-success';
                        break;
                    case 'Processing':
                        statusClass = 'bg-warning text-dark';
                        break;
                    case 'Shipped':
                        statusClass = 'bg-info';
                        break;
                    case 'Cancelled':
                        statusClass = 'bg-danger';
                        break;
                    default:
                        statusClass = 'bg-secondary';
                }
                
                row.innerHTML = `
                    <td>#${order.orderNumber}</td>
                    <td>${order.userName}</td>
                    <td>${orderDate}</td>
                    <td>$${order.finalAmount.toFixed(2)}</td>
                    <td><span class="status-badge ${statusClass}">${order.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-light view-order" data-order-id="${order.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-order').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order-id');
                    viewOrderDetails(orderId);
                });
            });
        }

        // View order details
        async function viewOrderDetails(orderId) {
            try {
                const response = await fetch(`${API_BASE}/Orders/${orderId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const order = await response.json();
                    
                    // Populate modal with order details
                    document.getElementById('orderNumber').textContent = order.orderNumber;
                    
                    // Customer info
                    document.getElementById('customerInfo').innerHTML = `
                        ${order.userName}<br>
                        ${order.userEmail || 'No email'}
                    `;
                    
                    // Shipping address
                    const address = order.shippingAddress;
                    document.getElementById('shippingAddress').innerHTML = `
                        ${address.fullName}<br>
                        ${address.street}<br>
                        ${address.city}, ${address.region} ${address.postalCode}<br>
                        ${address.country}<br>
                        Phone: ${address.phoneNumber}
                    `;
                    
                    // Order items
                    const itemsTbody = document.querySelector('#orderItemsTable tbody');
                    itemsTbody.innerHTML = '';
                    
                    order.orderItems.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.productName}</td>
                            <td>${item.quantity}</td>
                            <td>$${item.unitPrice.toFixed(2)}</td>
                            <td>$${item.totalPrice.toFixed(2)}</td>
                        `;
                        itemsTbody.appendChild(row);
                    });
                    
                    // Order totals
                    document.getElementById('orderSubtotal').textContent = `$${order.orderTotal.toFixed(2)}`;
                    document.getElementById('orderDiscount').textContent = order.discountAmount ? `-$${order.discountAmount.toFixed(2)}` : '$0.00';
                    document.getElementById('orderTotal').textContent = `$${order.finalAmount.toFixed(2)}`;
                    
                    // Set current status
                    document.getElementById('orderStatusSelect').value = order.status;
                    document.getElementById('updateOrderStatus').setAttribute('data-order-id', order.id);
                    
                    // Show modal
                    const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
                    modal.show();
                }
            } catch (error) {
                console.error('Error fetching order details:', error);
                alert('Failed to load order details.');
            }
        }

        // Update order status
        async function updateOrderStatus() {
            const orderId = this.getAttribute('data-order-id');
            const newStatus = document.getElementById('orderStatusSelect').value;
            
            try {
                const response = await fetch(`${API_BASE}/Orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                
                if (response.ok) {
                    alert('Order status updated successfully.');
                    // Refresh orders table
                    await loadOrders();
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('orderDetailModal')).hide();
                } else {
                    alert('Failed to update order status.');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                alert('Failed to update order status.');
            }
        }

        // Load orders
        async function loadOrders(status = '', page = 1) {
            try {
                let url = `${API_BASE}/Orders/all`;
                if (status) {
                    url += `?status=${status}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const orders = await response.json();
                    displayOrders(orders, page);
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        // Display orders in table
        function displayOrders(orders, page) {
            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = '';
            
            // Simple pagination (for demo purposes)
            const itemsPerPage = 10;
            const startIndex = (page - 1) * itemsPerPage;
            const paginatedOrders = orders.slice(startIndex, startIndex + itemsPerPage);
            
            paginatedOrders.forEach(order => {
                const row = document.createElement('tr');
                
                // Format order date
                const orderDate = new Date(order.orderDate).toLocaleDateString();
                
                // Create status badge
                let statusClass = '';
                switch(order.status) {
                    case 'Delivered':
                        statusClass = 'bg-success';
                        break;
                    case 'Processing':
                        statusClass = 'bg-warning text-dark';
                        break;
                    case 'Shipped':
                        statusClass = 'bg-info';
                        break;
                    case 'Cancelled':
                        statusClass = 'bg-danger';
                        break;
                    default:
                        statusClass = 'bg-secondary';
                }
                
                row.innerHTML = `
                    <td>#${order.orderNumber}</td>
                    <td>${order.userName}</td>
                    <td>${orderDate}</td>
                    <td>$${order.finalAmount.toFixed(2)}</td>
                    <td><span class="status-badge ${statusClass}">${order.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-light view-order" data-order-id="${order.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-order').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order-id');
                    viewOrderDetails(orderId);
                });
            });
            
            // Update pagination
            updatePagination('ordersPagination', orders.length, page, itemsPerPage, (newPage) => {
                loadOrders('', newPage);
            });
        }

        // Load products
        async function loadProducts(categoryId = '', search = '', page = 1) {
            try {
                let url = `${API_BASE}/Products`;
                const params = [];
                
                if (categoryId) params.push(`categoryId=${categoryId}`);
                if (search) params.push(`search=${encodeURIComponent(search)}`);
                
                if (params.length > 0) {
                    url += `?${params.join('&')}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const products = await response.json();
                    displayProducts(products, page);
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // Display products in table
       function displayProducts(products, page) {
    const tbody = document.querySelector('#productsTable tbody');
    tbody.innerHTML = '';
    
    // Simple pagination (for demo purposes)
    const itemsPerPage = 10;
    const startIndex = (page - 1) * itemsPerPage;
    const paginatedProducts = products.slice(startIndex, startIndex + itemsPerPage);
    
    paginatedProducts.forEach(product => {
        const row = document.createElement('tr');
        
        // Get primary image - FIXED VERSION
        let imageHtml = '<div class="product-image bg-light d-flex align-items-center justify-content-center"><i class="fas fa-image text-muted"></i></div>';

        if (product.images && product.images.length > 0) {
            const primaryImage = product.images.find(img => img.isPrimary) || product.images[0];
            if (primaryImage && primaryImage.imageData) {
                const base64Image = arrayBufferToBase64(primaryImage.imageData);
                imageHtml = `<img src="data:${primaryImage.mimeType};base64,${base64Image}" class="product-image" alt="${product.name}" style="object-fit: cover; width: 60px; height: 60px;">`;
            }
        }
        
        // Status badge
        const statusClass = product.status === 'Active' ? 'bg-success' : 'bg-secondary';
        
        row.innerHTML = `
            <td>
                <div class="d-flex align-items-center">
                    ${imageHtml}
                    <div class="ms-3">
                        <div class="fw-bold">${product.name}</div>
                        <small class="text-muted">${product.description?.substring(0, 50)}${product.description?.length > 50 ? '...' : ''}</small>
                    </div>
                </div>
            </td>
            <td>${product.categoryName}</td>
            <td>$${product.price.toFixed(2)}</td>
            <td>${product.stockQuantity}</td>
            <td><span class="status-badge ${statusClass}">${product.status}</span></td>
            <td>
                <button class="btn btn-sm btn-light me-1 edit-product" data-product-id="${product.id}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger delete-product" data-product-id="${product.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    // Add event listeners to edit and delete buttons
    document.querySelectorAll('.edit-product').forEach(btn => {
        btn.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            editProduct(productId);
        });
    });
    
    document.querySelectorAll('.delete-product').forEach(btn => {
        btn.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            deleteProduct(productId);
        });
    });
    
    // Update pagination
    updatePagination('productsPagination', products.length, page, itemsPerPage, (newPage) => {
        loadProducts('', '', newPage);
    });
}

        // Convert array buffer to base64 for image display
       // Convert byte array to base64 for image display - FIXED VERSION
function arrayBufferToBase64(buffer) {
    if (!buffer || buffer.length === 0) return '';
    
    // If it's already a base64 string, return it
    if (typeof buffer === 'string') return buffer;
    
    // If it's an array of numbers, convert to Uint8Array
    let bytes;
    if (Array.isArray(buffer)) {
        bytes = new Uint8Array(buffer);
    } else if (buffer instanceof ArrayBuffer) {
        bytes = new Uint8Array(buffer);
    } else {
        // Assume it's already a Uint8Array
        bytes = buffer;
    }
    
    let binary = '';
    const len = bytes.byteLength;
    for (let i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
}

        // Add new product
        async function addProduct() {
            const formData = new FormData();
            
            // Get form values
            const name = document.getElementById('productName').value;
            const categoryId = document.getElementById('productCategory').value;
            const price = document.getElementById('productPrice').value;
            const stock = document.getElementById('productStock').value;
            const description = document.getElementById('productDescription').value;
            const imageFiles = document.getElementById('productImages').files;
            
            // Append data to formData
            formData.append('Name', name);
            formData.append('CategoryId', categoryId);
            formData.append('Price', price);
            formData.append('StockQuantity', stock);
            formData.append('Description', description);
            
            // Append image files
            for (let i = 0; i < imageFiles.length; i++) {
                formData.append('ImageFiles', imageFiles[i]);
            }
            
            try {
                const response = await fetch(`${API_BASE}/Products`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const newProduct = await response.json();
                    alert('Product added successfully!');
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
                    // Refresh products table
                    await loadProducts();
                } else {
                    alert('Failed to add product.');
                }
            } catch (error) {
                console.error('Error adding product:', error);
                alert('Failed to add product.');
            }
        }

        // Edit product
        async function editProduct(productId) {
    try {
        const response = await fetch(`${API_BASE}/Products/${productId}`, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
        
        if (response.ok) {
            const product = await response.json();
            
            // Populate the edit form
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductCategory').value = product.categoryId;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductStock').value = product.stockQuantity;
            document.getElementById('editProductDescription').value = product.description || '';
            document.getElementById('editProductStatus').value = product.status;
            
            // Display current images - FIXED VERSION
            const imagesContainer = document.getElementById('currentProductImages');
            imagesContainer.innerHTML = '';
            
            if (product.images && product.images.length > 0) {
                product.images.forEach(image => {
                    if (image.imageData) {
                        const base64Image = arrayBufferToBase64(image.imageData);
                        const img = document.createElement('img');
                        img.src = `data:${image.mimeType};base64,${base64Image}`;
                        img.className = 'image-preview';
                        img.alt = product.name;
                        img.style = 'object-fit: cover; width: 100px; height: 100px; margin-right: 10px; margin-bottom: 10px;';
                        imagesContainer.appendChild(img);
                    }
                });
            } else {
                imagesContainer.innerHTML = '<p>No images available</p>';
            }
            
            // Show the edit modal
            const modal = new bootstrap.Modal(document.getElementById('editProductModal'));
            modal.show();
        }
    } catch (error) {
        console.error('Error fetching product details:', error);
        alert('Failed to load product details.');
    }
}

        // Update product
        async function updateProduct() {
            const productId = document.getElementById('editProductId').value;
            const formData = new FormData();
            
            // Get form values
            const name = document.getElementById('editProductName').value;
            const categoryId = document.getElementById('editProductCategory').value;
            const price = document.getElementById('editProductPrice').value;
            const stock = document.getElementById('editProductStock').value;
            const description = document.getElementById('editProductDescription').value;
            const status = document.getElementById('editProductStatus').value;
            const imageFiles = document.getElementById('editProductImages').files;
            
            // Append data to formData
            formData.append('Name', name);
            formData.append('CategoryId', categoryId);
            formData.append('Price', price);
            formData.append('StockQuantity', stock);
            formData.append('Description', description);
            formData.append('Status', status);
            
            // Append image files
            for (let i = 0; i < imageFiles.length; i++) {
                formData.append('ImageFiles', imageFiles[i]);
            }
            
            try {
                const response = await fetch(`${API_BASE}/Products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const updatedProduct = await response.json();
                    alert('Product updated successfully!');
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('editProductModal')).hide();
                    // Refresh products table
                    await loadProducts();
                } else {
                    alert('Failed to update product.');
                }
            } catch (error) {
                console.error('Error updating product:', error);
                alert('Failed to update product.');
            }
        }

        // Delete product
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/Products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    alert('Product deleted successfully!');
                    // Refresh products table
                    await loadProducts();
                } else {
                    alert('Failed to delete product.');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                alert('Failed to delete product.');
            }
        }

        // Load categories
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/Categories`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const categories = await response.json();
                    populateCategoryDropdowns(categories);
                    displayCategories(categories);
                }
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // Populate category dropdowns
        function populateCategoryDropdowns(categories) {
            const categorySelects = document.querySelectorAll('#productCategory, #productCategoryFilter, #parentCategory, #editProductCategory, #editParentCategory');
            
            categorySelects.forEach(select => {
                // Clear existing options except the first one
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                // Add categories
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    select.appendChild(option);
                });
            });
        }

        // Display categories in table
        // Display categories in table - FIXED VERSION
function displayCategories(categories) {
    const tbody = document.querySelector('#categoriesTable tbody');
    tbody.innerHTML = '';
    
    categories.forEach(category => {
        const row = document.createElement('tr');
        
        // Category image - FIXED VERSION
        let imageHtml = '<div class="image-preview bg-light d-flex align-items-center justify-content-center"><i class="fas fa-image text-muted"></i></div>';

        if (category.categoryImage) {
            const base64Image = arrayBufferToBase64(category.categoryImage);
            imageHtml = `<img src="data:${category.imageMimeType};base64,${base64Image}" class="image-preview" alt="${category.name}" style="object-fit: cover; width: 100px; height: 100px;">`;
        }
        
        row.innerHTML = `
            <td>
                <div class="d-flex align-items-center">
                    ${imageHtml}
                    <div>
                        <div class="fw-bold">${category.name}</div>
                        <small class="text-muted">ID: ${category.id}</small>
                    </div>
                </div>
            </td>
            <td>${category.description || 'No description'}</td>
            <td>${category.productsCount || 0} products</td>
            <td>
                <button class="btn btn-sm btn-light me-1 edit-category" data-category-id="${category.id}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger delete-category" data-category-id="${category.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    // Add event listeners to edit and delete buttons
    document.querySelectorAll('.edit-category').forEach(btn => {
        btn.addEventListener('click', function() {
            const categoryId = this.getAttribute('data-category-id');
            editCategory(categoryId);
        });
    });
    
    document.querySelectorAll('.delete-category').forEach(btn => {
        btn.addEventListener('click', function() {
            const categoryId = this.getAttribute('data-category-id');
            deleteCategory(categoryId);
        });
    });
}

        // Add new category
        async function addCategory() {
            const formData = new FormData();
            
            // Get form values
            const name = document.getElementById('categoryName').value;
            const description = document.getElementById('categoryDescription').value;
            const parentCategoryId = document.getElementById('parentCategory').value;
            const imageFile = document.getElementById('categoryImage').files[0];
            
            // Append data to formData
            formData.append('Name', name);
            formData.append('Description', description);
            if (parentCategoryId) {
                formData.append('ParentCategoryId', parentCategoryId);
            }
            
            // Append image file
            if (imageFile) {
                formData.append('ImageFile', imageFile);
            }
            
            try {
                const response = await fetch(`${API_BASE}/Categories`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const newCategory = await response.json();
                    alert('Category added successfully!');
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('addCategoryModal')).hide();
                    // Refresh categories
                    await loadCategories();
                } else {
                    alert('Failed to add category.');
                }
            } catch (error) {
                console.error('Error adding category:', error);
                alert('Failed to add category.');
            }
        }

        // Edit category
        async function editCategory(categoryId) {
    try {
        const response = await fetch(`${API_BASE}/Categories/${categoryId}`, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
        
        if (response.ok) {
            const category = await response.json();
            
            // Populate the edit form
            document.getElementById('editCategoryId').value = category.id;
            document.getElementById('editCategoryName').value = category.name;
            document.getElementById('editCategoryDescription').value = category.description || '';
            document.getElementById('editParentCategory').value = category.parentCategoryId || '';
            
            // Display current image - FIXED VERSION
            const imageContainer = document.getElementById('currentCategoryImage');
            imageContainer.innerHTML = '';
            
            if (category.categoryImage) {
                const base64Image = arrayBufferToBase64(category.categoryImage);
                const img = document.createElement('img');
                img.src = `data:${category.imageMimeType};base64,${base64Image}`;
                img.className = 'image-preview';
                img.alt = category.name;
                img.style = 'object-fit: cover; width: 100px; height: 100px;';
                imageContainer.appendChild(img);
            } else {
                imageContainer.innerHTML = '<p>No image available</p>';
            }
            
            // Show the edit modal
            const modal = new bootstrap.Modal(document.getElementById('editCategoryModal'));
            modal.show();
        }
    } catch (error) {
        console.error('Error fetching category details:', error);
        alert('Failed to load category details.');
    }
}

        // Update category
        async function updateCategory() {
            const categoryId = document.getElementById('editCategoryId').value;
            const formData = new FormData();
            
            // Get form values
            const name = document.getElementById('editCategoryName').value;
            const description = document.getElementById('editCategoryDescription').value;
            const parentCategoryId = document.getElementById('editParentCategory').value;
            const imageFile = document.getElementById('editCategoryImage').files[0];
            
            // Append data to formData
            formData.append('Name', name);
            formData.append('Description', description);
            if (parentCategoryId) {
                formData.append('ParentCategoryId', parentCategoryId);
            } else {
                formData.append('ParentCategoryId', '');
            }
            
            // Append image file
            if (imageFile) {
                formData.append('ImageFile', imageFile);
            }
            
            try {
                const response = await fetch(`${API_BASE}/Categories/${categoryId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const updatedCategory = await response.json();
                    alert('Category updated successfully!');
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('editCategoryModal')).hide();
                    // Refresh categories
                    await loadCategories();
                } else {
                    alert('Failed to update category.');
                }
            } catch (error) {
                console.error('Error updating category:', error);
                alert('Failed to update category.');
            }
        }

        // Delete category
        async function deleteCategory(categoryId) {
            if (!confirm('Are you sure you want to delete this category?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/Categories/${categoryId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    alert('Category deleted successfully!');
                    // Refresh categories
                    await loadCategories();
                } else {
                    alert('Failed to delete category.');
                }
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('Failed to delete category.');
            }
        }

        // Load users
        async function loadUsers(page = 1) {
            try {
                const response = await fetch(`${API_BASE}/Users`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users, page);
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Display users in table
        function displayUsers(users, page) {
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = '';
            
            // Simple pagination (for demo purposes)
            const itemsPerPage = 10;
            const startIndex = (page - 1) * itemsPerPage;
            const paginatedUsers = users.slice(startIndex, startIndex + itemsPerPage);
            
            paginatedUsers.forEach(user => {
                const row = document.createElement('tr');
                
                // Format join date
                const joinDate = new Date(user.createdAt).toLocaleDateString();
                
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <img src="https://ui-avatars.com/api/?name=${user.firstName}+${user.lastName}&background=4361ee&color=fff" class="avatar me-3" alt="${user.firstName} ${user.lastName}">
                            <div>
                                <div class="fw-bold">${user.firstName} ${user.lastName}</div>
                                <small class="text-muted">${user.role}</small>
                            </div>
                        </div>
                    </td>
                    <td>${user.email}</td>
                    <td>${user.phone || 'N/A'}</td>
                    <td>${user.ordersCount || 0}</td>
                    <td>${joinDate}</td>
                    <td>
                        <button class="btn btn-sm btn-light me-1 edit-user" data-user-id="${user.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-user" data-user-id="${user.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update pagination
            updatePagination('usersPagination', users.length, page, itemsPerPage, (newPage) => {
                loadUsers(newPage);
            });
        }

        // Load coupons
        async function loadCoupons(active = null, page = 1) {
            try {
                let url = `${API_BASE}/Coupons`;
                if (active !== null) {
                    url += `?active=${active}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const coupons = await response.json();
                    displayCoupons(coupons, page);
                }
            } catch (error) {
                console.error('Error loading coupons:', error);
            }
        }

        // Display coupons in table
        function displayCoupons(coupons, page) {
            const tbody = document.querySelector('#couponsTable tbody');
            tbody.innerHTML = '';
            
            // Simple pagination (for demo purposes)
            const itemsPerPage = 10;
            const startIndex = (page - 1) * itemsPerPage;
            const paginatedCoupons = coupons.slice(startIndex, startIndex + itemsPerPage);
            
            paginatedCoupons.forEach(coupon => {
                const row = document.createElement('tr');
                
                // Format expiry date
                const expiryDate = new Date(coupon.expiryDate).toLocaleDateString();
                
                // Status badge
                const isExpired = new Date(coupon.expiryDate) < new Date();
                const statusClass = coupon.isActive && !isExpired ? 'bg-success' : 'bg-danger';
                const statusText = coupon.isActive && !isExpired ? 'Active' : 'Inactive';
                
                row.innerHTML = `
                    <td>
                        <div class="fw-bold">${coupon.couponCode}</div>
                        <small class="text-muted">${coupon.usedCount}/${coupon.usageLimit || ''} used</small>
                    </td>
                    <td>${coupon.discountPercentage}% off</td>
                    <td>${coupon.usedCount} times</td>
                    <td>${expiryDate}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-light me-1 edit-coupon" data-coupon-id="${coupon.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-coupon" data-coupon-id="${coupon.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-coupon').forEach(btn => {
                btn.addEventListener('click', function() {
                    const couponId = this.getAttribute('data-coupon-id');
                    editCoupon(couponId);
                });
            });
            
            document.querySelectorAll('.delete-coupon').forEach(btn => {
                btn.addEventListener('click', function() {
                    const couponId = this.getAttribute('data-coupon-id');
                    deleteCoupon(couponId);
                });
            });
            
            // Update pagination
            updatePagination('couponsPagination', coupons.length, page, itemsPerPage, (newPage) => {
                loadCoupons(active, newPage);
            });
        }

        // Add new coupon
        async function addCoupon() {
            const couponData = {
                couponCode: document.getElementById('couponCode').value,
                discountPercentage: parseFloat(document.getElementById('discountPercentage').value),
                expiryDate: document.getElementById('expiryDate').value,
                usageLimit: document.getElementById('usageLimit').value || null,
                minimumOrderAmount: document.getElementById('minOrderAmount').value || null
            };
            
            try {
                const response = await fetch(`${API_BASE}/Coupons`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(couponData)
                });
                
                if (response.ok) {
                    const newCoupon = await response.json();
                    alert('Coupon added successfully!');
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('addCouponModal')).hide();
                    // Refresh coupons table
                    await loadCoupons();
                } else {
                    alert('Failed to add coupon.');
                }
            } catch (error) {
                console.error('Error adding coupon:', error);
                alert('Failed to add coupon.');
            }
        }

        // Edit coupon
        async function editCoupon(couponId) {
            try {
                const response = await fetch(`${API_BASE}/Coupons/${couponId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const coupon = await response.json();
                    
                    // Populate the edit form
                    document.getElementById('editCouponId').value = coupon.id;
                    document.getElementById('editCouponCode').value = coupon.couponCode;
                    document.getElementById('editDiscountPercentage').value = coupon.discountPercentage;
                    document.getElementById('editExpiryDate').value = coupon.expiryDate.split('T')[0];
                    document.getElementById('editUsageLimit').value = coupon.usageLimit || '';
                    document.getElementById('editMinOrderAmount').value = coupon.minimumOrderAmount || '';
                    document.getElementById('editCouponStatus').value = coupon.isActive.toString();
                    
                    // Show the edit modal
                    const modal = new bootstrap.Modal(document.getElementById('editCouponModal'));
                    modal.show();
                }
            } catch (error) {
                console.error('Error fetching coupon details:', error);
                alert('Failed to load coupon details.');
            }
        }

        // Update coupon
        async function updateCoupon() {
            const couponId = document.getElementById('editCouponId').value;
            const couponData = {
                couponCode: document.getElementById('editCouponCode').value,
                discountPercentage: parseFloat(document.getElementById('editDiscountPercentage').value),
                expiryDate: document.getElementById('editExpiryDate').value,
                usageLimit: document.getElementById('editUsageLimit').value || null,
                minimumOrderAmount: document.getElementById('editMinOrderAmount').value || null,
                isActive: document.getElementById('editCouponStatus').value === 'true'
            };
            
            try {
                const response = await fetch(`${API_BASE}/Coupons/${couponId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(couponData)
                });
                
                if (response.ok) {
                    const updatedCoupon = await response.json();
                    alert('Coupon updated successfully!');
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('editCouponModal')).hide();
                    // Refresh coupons table
                    await loadCoupons();
                } else {
                    alert('Failed to update coupon.');
                }
            } catch (error) {
                console.error('Error updating coupon:', error);
                alert('Failed to update coupon.');
            }
        }

        // Delete coupon
        async function deleteCoupon(couponId) {
            if (!confirm('Are you sure you want to delete this coupon?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/Coupons/${couponId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    alert('Coupon deleted successfully!');
                    // Refresh coupons table
                    await loadCoupons();
                } else {
                    alert('Failed to delete coupon.');
                }
            } catch (error) {
                console.error('Error deleting coupon:', error);
                alert('Failed to delete coupon.');
            }
        }

        // Load reviews
        async function loadReviews(filter = 'all', page = 1) {
            try {
                const response = await fetch(`${API_BASE}/Reviews`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const reviews = await response.json();
                    displayReviews(reviews, filter, page);
                }
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }

        // Display reviews in table
        function displayReviews(reviews, filter, page) {
            const tbody = document.querySelector('#reviewsTable tbody');
            tbody.innerHTML = '';
            
            // Filter reviews
            let filteredReviews = reviews;
            if (filter !== 'all') {
                // This would need to be adjusted based on your actual review status values
                filteredReviews = reviews.filter(review => review.status === filter);
            }
            
            // Simple pagination (for demo purposes)
            const itemsPerPage = 10;
            const startIndex = (page - 1) * itemsPerPage;
            const paginatedReviews = filteredReviews.slice(startIndex, startIndex + itemsPerPage);
            
            paginatedReviews.forEach(review => {
                const row = document.createElement('tr');
                
                // Format review date
                const reviewDate = new Date(review.createdDate).toLocaleDateString();
                
                // Star rating
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    stars += `<i class="fas fa-star ${i <= review.rating ? 'text-warning' : 'text-muted'}"></i>`;
                }
                
                row.innerHTML = `
                    <td>${review.productName}</td>
                    <td>${review.userName}</td>
                    <td>${stars}</td>
                    <td>${review.comment?.substring(0, 50) || 'No comment'}${review.comment?.length > 50 ? '...' : ''}</td>
                    <td>${reviewDate}</td>
                    <td><span class="status-badge bg-secondary">${review.status || 'Pending'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-success me-1 approve-review" data-review-id="${review.id}">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-sm btn-danger reject-review" data-review-id="${review.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update pagination
            updatePagination('reviewsPagination', filteredReviews.length, page, itemsPerPage, (newPage) => {
                loadReviews(filter, newPage);
            });
        }

        // Update pagination controls
        function updatePagination(elementId, totalItems, currentPage, itemsPerPage, onPageChange) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationElement = document.getElementById(elementId);
            
            if (totalPages <= 1) {
                paginationElement.innerHTML = '';
                return;
            }
            
            let paginationHtml = '';
            
            // Previous button
            paginationHtml += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>
                </li>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                paginationHtml += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                    </li>
                `;
            }
            
            // Next button
            paginationHtml += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>
                </li>
            `;
            
            paginationElement.innerHTML = paginationHtml;
            
            // Add event listeners to page links
            paginationElement.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    onPageChange(page);
                });
            });
        }

        // Logout function
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>